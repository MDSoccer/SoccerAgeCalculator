<!-- PSC Age Group Calculator (2026–2027 Season) -->
<div class="psc-agecalc" role="region" aria-label="Soccer age group calculator">
  <div class="psc-agecalc__header">
    <h3 class="psc-agecalc__title">Age Group Calculator (2026–27)</h3>
    <p class="psc-agecalc__subtitle">
      Uses the seasonal-year cutoff <strong>Aug 1 – Jul 31</strong> for the 2026–27 season.
    </p>
  </div>

  <form class="psc-agecalc__form" id="pscAgeCalcForm" novalidate>
    <label class="psc-agecalc__label" for="pscDob">Player Date of Birth</label>

    <div class="psc-input-wrap" id="pscDobWrap">
      <span class="psc-input-ghost" aria-hidden="true">MM/DD/YYYY</span>
      <input
        class="psc-agecalc__input psc-masked-input"
        id="pscDob"
        name="pscDob"
        type="text"
        inputmode="numeric"
        autocomplete="bday"
        aria-describedby="pscAgeCalcHelp pscAgeCalcError"
        maxlength="10"
      />
    </div>

    <button class="psc-agecalc__btn" id="pscAgeCalcBtn" type="submit" disabled>
      Calculate
    </button>
    </div>

    <p class="psc-agecalc__help" id="pscAgeCalcHelp">
      Tip: You can also paste dates like <em>2016-09-14</em> or <em>9/14/2016</em>.
    </p>

    <p class="psc-agecalc__error" id="pscAgeCalcError" aria-live="polite"></p>

    <div class="psc-agecalc__result" id="pscAgeCalcResult" aria-live="polite">
      <span class="psc-agecalc__result-label">Player’s Age Group:</span>
      <span class="psc-agecalc__result-value" id="pscAgeCalcValue">—</span>
    </div>
  </form>

  <details class="psc-agecalc__details">
    <summary>Show 2026–27 age-group ranges</summary>
    <div class="psc-agecalc__tablewrap" aria-label="Age group ranges table">
      <table class="psc-agecalc__table">
        <thead>
          <tr>
            <th>Age Group</th>
            <th>Birth Date Range (Inclusive)</th>
          </tr>
        </thead>
        <tbody id="pscAgeCalcTableBody"></tbody>
      </table>
    </div>
  </details>
</div>

<style>
  .psc-agecalc{
    max-width: 780px;
    margin: 18px auto;
    padding: 18px;
    border: 1px solid rgba(0,0,0,.12);
    border-radius: 12px;
    background: rgba(255,255,255,.9);
  }
  .psc-agecalc__title{ margin: 0 0 6px 0; }
  .psc-agecalc__subtitle{ margin: 0 0 14px 0; opacity: .85; }
  .psc-agecalc__label{ display:block; font-weight: 600; margin-bottom: 8px; }
  .psc-agecalc__row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .psc-agecalc__input{
    flex: 1 1 220px;
    padding: 12px 12px;
    border: 1px solid rgba(0,0,0,.18);
    border-radius: 10px;
    font-size: 16px;
  }
  .psc-agecalc__btn{
    flex: 0 0 auto;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,.18);
    cursor: pointer;
    font-weight: 700;
  }
  .psc-agecalc__help{ margin: 10px 0 0 0; font-size: 13px; opacity: .8; }
  .psc-agecalc__error{ margin: 10px 0 0 0; font-size: 14px; color: #b00020; min-height: 1.2em; }
  .psc-agecalc__result{
    margin-top: 14px;
    padding: 12px;
    border-radius: 10px;
    background: rgba(0,0,0,.04);
    display:flex;
    gap:8px;
    align-items:baseline;
    flex-wrap:wrap;
  }
  .psc-agecalc__result-label{ font-weight: 700; }
  .psc-agecalc__result-value{ font-weight: 800; font-size: 18px; }
  .psc-agecalc__details{ margin-top: 14px; }
  .psc-agecalc__tablewrap{ overflow:auto; margin-top: 10px; }
  .psc-agecalc__table{
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  .psc-agecalc__table th, .psc-agecalc__table td{
    border-bottom: 1px solid rgba(0,0,0,.12);
    padding: 10px 8px;
    text-align: left;
    white-space: nowrap;
  }
  .psc-agecalc__btn[disabled]{ opacity:.55; cursor:not-allowed; }
  .psc-agecalc__input.is-invalid{ border-color:#b00020; outline-color:#b00020; }
  .psc-input-wrap{
    position:relative;
    width:100%;
    max-width:400px;
  }

  .psc-masked-input{
    position:relative;
    background:transparent;
    z-index:2;
  }

  .psc-input-ghost{
    position:absolute;
    top:50%;
    left:14px;
    transform:translateY(-50%);
    color:rgba(0,0,0,0.25);
    pointer-events:none;
    font-family:inherit;
    font-size:16px;
    letter-spacing:1px;
    z-index:1;
  }

  /* When user starts typing, fade ghost */
  .psc-masked-input:not(:placeholder-shown) + .psc-input-ghost,
  .psc-masked-input:focus + .psc-input-ghost{
    opacity:0;
  }
</style>

<script>
(function(){
  // --- 2026–27 seasonal-year ranges (inclusive) ---
  const RANGES = [
    { group: "U19", start: "2007-08-01", end: "2009-07-31" },
    { group: "U17", start: "2009-08-01", end: "2010-07-31" },
    { group: "U16", start: "2010-08-01", end: "2011-07-31" },
    { group: "U15", start: "2011-08-01", end: "2012-07-31" },
    { group: "U14", start: "2012-08-01", end: "2013-07-31" },
    { group: "U13", start: "2013-08-01", end: "2014-07-31" },
    { group: "U12", start: "2014-08-01", end: "2015-07-31" },
    { group: "U11", start: "2015-08-01", end: "2016-07-31" },
    { group: "U10", start: "2016-08-01", end: "2017-07-31" },
    { group: "U9",  start: "2017-08-01", end: "2018-07-31" },
    { group: "U8",  start: "2018-08-01", end: "2019-07-31" },
    { group: "U7",  start: "2019-08-01", end: "2020-07-31" }
  ].map(r => ({
    ...r,
    startDate: new Date(r.start + "T00:00:00"),
    endDate: new Date(r.end + "T23:59:59")
  }));

  const form = document.getElementById("pscAgeCalcForm");
  const dobInput = document.getElementById("pscDob");
  const btn = document.getElementById("pscAgeCalcBtn");
  const errorEl = document.getElementById("pscAgeCalcError");
  const valueEl = document.getElementById("pscAgeCalcValue");
  const tableBody = document.getElementById("pscAgeCalcTableBody");

  function pad2(n){ return String(n).padStart(2,"0"); }

  function formatMDY(d){
    return `${pad2(d.getMonth()+1)}/${pad2(d.getDate())}/${d.getFullYear()}`;
  }

  function buildTable(){
    if(!tableBody) return;
    tableBody.innerHTML = RANGES.map(r => {
      const s = formatMDY(r.startDate);
      const e = formatMDY(new Date(r.endDate.getFullYear(), r.endDate.getMonth(), r.endDate.getDate()));
      return `<tr><td><strong>${r.group}</strong></td><td>${s} – ${e}</td></tr>`;
    }).join("");
  }

  // ---------- UX helpers ----------
  function setError(msg){
    errorEl.textContent = msg || "";
    dobInput.classList.toggle("is-invalid", !!msg);
  }
  function setResult(txt){
    valueEl.textContent = txt || "—";
  }
  function setButtonEnabled(ok){
    btn.disabled = !ok;
  }

  // ---------- Input masking ----------
  // Goal: as user types digits, show MM/DD/YYYY with slashes inserted.
  // Accepts: 81214, 081214, 8/12/14, 08/12/14, 2014-08-12, etc.
  function digitsOnly(s){ return String(s || "").replace(/\D/g, ""); }

  function maskToMDY(raw){
    // Returns display string formatted as MM/DD/YYYY-ish (partial allowed)
    const d = digitsOnly(raw).slice(0, 8); // MMDDYYYY max digits
    let out = "";
    if(d.length <= 2) out = d;
    else if(d.length <= 4) out = d.slice(0,2) + "/" + d.slice(2);
    else out = d.slice(0,2) + "/" + d.slice(2,4) + "/" + d.slice(4);
    return out;
  }

  // ---------- Parsing / normalization ----------
  // Returns { date: Date|null, normalized: "MM/DD/YYYY"|null, reason?: string }
  function parseDOBSmart(raw){
    const v = String(raw || "").trim();
    if(!v) return { date:null, normalized:null };

    // Accept ISO YYYY-MM-DD
    let m = v.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
    if(m){
      const y = +m[1], mo = +m[2], da = +m[3];
      const d = safeDate(y, mo, da);
      if(!d) return { date:null, normalized:null, reason:"Invalid date." };
      return { date:d, normalized: `${pad2(mo)}/${pad2(da)}/${y}` };
    }

    // Pull digits for MMDD(YY|YYYY)
    const dig = digitsOnly(v);

    // Handle 5-6 digits like MDDYY? Too ambiguous. We support 4,6,8 or slash forms.
    // Slash forms are handled by digits logic too; we just interpret by length.
    if(dig.length === 8){
      const mo = +dig.slice(0,2);
      const da = +dig.slice(2,4);
      const y  = +dig.slice(4,8);
      const d = safeDate(y, mo, da);
      if(!d) return { date:null, normalized:null, reason:"Invalid date." };
      return { date:d, normalized: `${pad2(mo)}/${pad2(da)}/${y}` };
    }

    if(dig.length === 6){
      // MMDDYY -> choose century. For youth soccer, 20YY is overwhelmingly likely.
      const mo = +dig.slice(0,2);
      const da = +dig.slice(2,4);
      const yy = +dig.slice(4,6);

      // Century heuristic:
      // 00–30 => 2000–2030, else 1900–1999
      const y = (yy <= 30) ? (2000 + yy) : (1900 + yy);

      const d = safeDate(y, mo, da);
      if(!d) return { date:null, normalized:null, reason:"Invalid date." };
      return { date:d, normalized: `${pad2(mo)}/${pad2(da)}/${y}` };
    }

    // If user typed like 8/12/2014 (1-digit month/day), browser input will keep slashes.
    // Digits would be 8122014 (7 digits) — we can support that:
    if(dig.length === 7){
      // Interpret as MDDYYYY or MM D YYYY? Prefer MDDYYYY when first digit is month (1-9)
      // We'll parse as: M + DD + YYYY (1 + 2 + 4) => 7 digits
      const mo = +dig.slice(0,1);
      const da = +dig.slice(1,3);
      const y  = +dig.slice(3,7);
      const d = safeDate(y, mo, da);
      if(!d) return { date:null, normalized:null, reason:"Invalid date." };
      return { date:d, normalized: `${pad2(mo)}/${pad2(da)}/${y}` };
    }

    // 4 digits like MMDD is incomplete
    if(dig.length < 6){
      return { date:null, normalized:null, reason:"Enter full birth date (MM/DD/YYYY)." };
    }

    // Anything else: reject (avoids guessing)
    return { date:null, normalized:null, reason:"Please enter as MM/DD/YYYY." };
  }

  function safeDate(year, month, day){
    if(month < 1 || month > 12) return null;
    if(day < 1 || day > 31) return null;
    const d = new Date(year, month-1, day);
    if(d.getFullYear() !== year || d.getMonth() !== (month-1) || d.getDate() !== day) return null;
    return d;
  }

  function calcGroup(dob){
    for(const r of RANGES){
      if(dob >= r.startDate && dob <= r.endDate) return r.group;
    }
    return null;
  }

  // ---------- Live validation (before submit) ----------
  function validateLive(showMessages){
    const parsed = parseDOBSmart(dobInput.value);

    // Incomplete/invalid
    if(!parsed.date){
      setButtonEnabled(false);
      setResult("—");
      if(showMessages && parsed.reason) setError(parsed.reason);
      else setError("");
      return { ok:false, parsed };
    }

    // If valid, normalize input to MM/DD/YYYY (nice for users)
    if(parsed.normalized) dobInput.value = parsed.normalized;

    // Range check
    const group = calcGroup(parsed.date);
    if(!group){
      setButtonEnabled(false);
      setResult("Out of range");
      if(showMessages) setError("That birth date is outside the listed 2026–27 youth age groups.");
      else setError("");
      return { ok:false, parsed };
    }

    // Good
    setError("");
    setButtonEnabled(true);
    return { ok:true, parsed, group };
  }

  // Masking: format as user types digits, but don’t fight when they paste ISO.
  dobInput.addEventListener("input", function(){
    const v = dobInput.value.trim();

    // If they paste ISO, keep it and just validate
    if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(v)){
      validateLive(false);
      return;
    }

    // Otherwise, apply MM/DD/YYYY mask from digits
    const masked = maskToMDY(v);
    if(masked !== dobInput.value) dobInput.value = masked;

    // Validate quietly while typing (no red error spam)
    validateLive(false);
  });

  // On blur, show messages if still invalid
  dobInput.addEventListener("blur", function(){
    validateLive(true);
  });

  form.addEventListener("submit", function(e){
    e.preventDefault();
    const res = validateLive(true);
    if(!res.ok) return;

    // Now we can safely compute/display the group
    const group = calcGroup(res.parsed.date);
    setResult(group);
  });

  buildTable();
  // Initialize button state on load
  validateLive(false);
})();
</script>
